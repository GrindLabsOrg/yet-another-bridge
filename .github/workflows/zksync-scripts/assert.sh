#!/bin/bash

. contracts/utils/colors.sh #for ANSI colors

assert() {
  # Usage: assert <condition> <placeholder_text> <expected_value> <obtained_value>
  if eval "$1"; then
    printf "${GREEN}✓ $2 passed.${RESET}\n"
  else
    printf "${RED}⨯ $2 assertion failed: Expected value: $3, Obtained value: $4.${RESET}\n"
    # exit 1
  fi
}

# echo ""
# assert " [[ $MM_INITIAL_BALANCE_L1 -eq 99999998999999999999994843134499267961 ]]" "MM_INITIAL_BALANCE_L1" "99999998999999999999994843134499267961" "$MM_INITIAL_BALANCE_L1"
# assert " [[ $MM_AFTER_BALANCE_L1 -eq 99999998999999999999994843134499267961 ]]" "MM_AFTER_BALANCE_L1" "99999998999999999999994843134499267961" "$MM_AFTER_BALANCE_L1"

# DESTINATION_FINAL_BALANCE=$(cast balance --rpc-url $ETHEREUM_RPC $DESTINATION_ADDRESS)
# EXPECTED_DESTINATION_FINAL_BALANCE=10001000000000000000000
# assert "[[ $DESTINATION_FINAL_BALANCE -eq $EXPECTED_DESTINATION_FINAL_BALANCE ]]" "Destination balance" "$EXPECTED_DESTINATION_FINAL_BALANCE" "$DESTINATION_FINAL_BALANCE"

# ESCROW_FINAL_BALANCE=$(starkli balance --raw $ESCROW_CONTRACT_ADDRESS)
# EXPECTED_ESCROW_FINAL_BALANCE=0
# assert "[[ $ESCROW_FINAL_BALANCE -eq $EXPECTED_ESCROW_FINAL_BALANCE ]]" "Escrow balance" "$EXPECTED_ESCROW_FINAL_BALANCE" "$ESCROW_FINAL_BALANCE"

# MM_FINAL_BALANCE=$(starkli balance --raw $MM_STARKNET_WALLET_ADDRESS)
# EXPECTED_MM_FINAL_BALANCE=1001000025000000000000
# assert "[[ $MM_FINAL_BALANCE -eq $EXPECTED_MM_FINAL_BALANCE ]]" "MM balance" "$EXPECTED_MM_FINAL_BALANCE" "$MM_FINAL_BALANCE"

# if [ ! "$MM_INITIAL_BALANCE_L1" = "99999998999999999999994843134499267961" ]; then
#     echo Error in MM_INITIAL_BALANCE_L1
# fi

echo "in assert.sh\n"

#setorder
echo setOrder
echo $BALANCE_USER_L2_BEFORE_SETORDER
echo $BALANCE_ESCROW_L2_BEFORE_SETORDER
echo $BALANCE_USER_L2_AFTER_SETORDER
echo $BALANCE_ESCROW_L2_AFTER_SETORDER

#transfer
echo transfer
echo $BALANCE_MM_L1_BEFORE_TRANSFER
echo $BALANCE_USER_L1_BEFORE_TRANSFER
echo $BALANCE_MM_L1_AFTER_TRANSFER
echo $BALANCE_USER_L1_AFTER_TRANSFER

#claimpeyment
echo claimPayment
echo $BALANCE_MM_L1_BEFORE_CLAIMPAYMENT
echo $BALANCE_MM_L2_BEFORE_CLAIMPAYMENT
echo $BALANCE_ESCROW_L2_BEFORE_CLAIMPAYMENT
echo $BALANCE_MM_L1_AFTER_CLAIMPAYMENT
echo $BALANCE_MM_L2_AFTER_CLAIMPAYMENT
echo $BALANCE_ESCROW_L2_AFTER_CLAIMPAYMENT